<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dairy Farm - AgriFlow</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="main-header">
            <div class="logo-container">
                <button class="back-btn" onclick="window.history.back()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h1>Dairy Farm</h1>
                    <p class="tagline" id="farmName">My Farm</p>
                </div>
            </div>
            <button class="menu-btn" onclick="navigateTo('settings.html')">
                <i class="fas fa-cog"></i>
            </button>
        </header>

        <!-- Quick Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-wine-bottle"></i>
                </div>
                <div class="stat-content">
                    <h3>Milk Today</h3>
                    <div class="stat-value" id="milkToday">0 L</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-content">
                    <h3>Monthly Profit</h3>
                    <div class="stat-value" id="monthlyProfit">KES 0</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-cow"></i>
                </div>
                <div class="stat-content">
                    <h3>Total Animals</h3>
                    <div class="stat-value" id="totalAnimals">0</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="stat-content">
                    <h3>Health</h3>
                    <div class="stat-value" id="healthStatus">100%</div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-bar">
            <button class="action-btn primary" onclick="addMilkProduction()">
                <i class="fas fa-plus-circle"></i>
                <span>Add Milk</span>
            </button>
            <button class="action-btn secondary" onclick="addAnimal()">
                <i class="fas fa-plus-circle"></i>
                <span>Add Animal</span>
            </button>
            <button class="action-btn secondary" onclick="recordExpense()">
                <i class="fas fa-money-bill-wave"></i>
                <span>Add Expense</span>
            </button>
        </div>

        <!-- Charts Section -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> Production Trend</h2>
                <select class="period-select" onchange="updateChart()">
                    <option value="7">7 Days</option>
                    <option value="30" selected>30 Days</option>
                    <option value="90">90 Days</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="milkChart"></canvas>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-history"></i> Recent Activity</h2>
                <button class="btn-small" onclick="showAllActivities()">
                    View All
                </button>
            </div>
            <div class="activity-list" id="activityList">
                <div class="empty-state">
                    <i class="fas fa-info-circle"></i>
                    <p>No activities recorded yet</p>
                    <button class="btn-action" onclick="addMilkProduction()">Add First Record</button>
                </div>
            </div>
        </div>

        <!-- Herd Summary -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Herd Summary</h2>
            </div>
            <div class="herd-grid">
                <div class="herd-card">
                    <div class="herd-count" id="milkingCows">0</div>
                    <div class="herd-label">Milking Cows</div>
                </div>
                <div class="herd-card">
                    <div class="herd-count" id="dryCows">0</div>
                    <div class="herd-label">Dry Cows</div>
                </div>
                <div class="herd-card">
                    <div class="herd-count" id="calves">0</div>
                    <div class="herd-label">Calves</div>
                </div>
                <div class="herd-card">
                    <div class="herd-count" id="pregnant">0</div>
                    <div class="herd-label">Pregnant</div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-btn">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="dairy.html" class="nav-btn active">
                <i class="fas fa-cow"></i>
                <span>Dairy</span>
            </a>
            <a href="poultry.html" class="nav-btn">
                <i class="fas fa-egg"></i>
                <span>Poultry</span>
            </a>
            <a href="master-report.html" class="nav-btn">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>
            <a href="settings.html" class="nav-btn">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>

    <!-- Modals -->
    <div id="addMilkModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-wine-bottle"></i> Record Milk Production</h3>
            <div class="form-group">
                <label for="milkQuantity">Quantity (Liters)</label>
                <input type="number" id="milkQuantity" step="0.1" min="0" placeholder="Enter liters">
            </div>
            <div class="form-actions">
                <button class="btn-secondary" onclick="closeModal('addMilkModal')">Cancel</button>
                <button class="btn-primary" onclick="saveMilkProduction()">Save</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/charts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadDairyData();
            updateChart();
            
            // Update navigation active state
            updateNavActiveState();
        });
        
        function loadDairyData() {
            // Load data from localStorage
            const data = JSON.parse(localStorage.getItem('agriflowData')) || {};
            const dairy = data.dairy || { milkProduction: [], animals: [] };
            
            // Update UI
            updateDairyUI(dairy);
        }
        
        function updateDairyUI(dairy) {
            // Calculate totals
            const today = new Date().toISOString().split('T')[0];
            const todayMilk = dairy.milkProduction
                .filter(p => p.date === today)
                .reduce((sum, p) => sum + (p.liters || 0), 0);
            
            const totalMilk = dairy.milkProduction.reduce((sum, p) => sum + (p.liters || 0), 0);
            
            // Update displays
            document.getElementById('milkToday').textContent = todayMilk.toFixed(1) + ' L';
            document.getElementById('totalAnimals').textContent = dairy.animals.length;
            
            // Update activity list
            updateActivityList(dairy.milkProduction.slice(-3).reverse());
        }
        
        function updateActivityList(activities) {
            const container = document.getElementById('activityList');
            if (!activities || activities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-info-circle"></i>
                        <p>No activities recorded yet</p>
                        <button class="btn-action" onclick="addMilkProduction()">Add First Record</button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            activities.forEach(activity => {
                const date = new Date(activity.date).toLocaleDateString();
                html += `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-wine-bottle"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-title">Milk Production</div>
                            <div class="activity-subtitle">${date} â€¢ ${activity.quality || 'Good'}</div>
                        </div>
                        <div class="activity-value">${activity.liters} L</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
        
        function addMilkProduction() {
            document.getElementById('addMilkModal').style.display = 'flex';
        }
        
        function saveMilkProduction() {
            const quantity = parseFloat(document.getElementById('milkQuantity').value);
            if (!quantity || quantity <= 0) {
                alert('Please enter a valid quantity');
                return;
            }
            
            const record = {
                date: new Date().toISOString().split('T')[0],
                liters: quantity,
                quality: 'Good'
            };
            
            // Save to app
            if (window.app) {
                window.app.addProduction('dairy', record);
            }
            
            closeModal('addMilkModal');
            document.getElementById('milkQuantity').value = '';
            loadDairyData();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function updateNavActiveState() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('href') === 'dairy.html') {
                    btn.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>
