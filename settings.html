<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Settings - AgriFlow</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="main-header">
            <div class="logo-container">
                <button class="back-btn" onclick="window.history.back()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h1>Settings</h1>
                    <p class="tagline">Configure your farm management</p>
                </div>
            </div>
        </header>

        <div class="settings-container">
            <!-- Appearance Settings -->
            <div class="settings-section">
                <div class="section-header">
                    <h2><i class="fas fa-palette"></i> Appearance</h2>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Dark Mode</h3>
                        <p>Toggle between light and dark theme</p>
                    </div>
                    <div class="setting-control">
                        <label class="theme-toggle">
                            <input type="checkbox" id="themeToggle">
                            <span class="toggle-slider">
                                <span class="toggle-icon sun"><i class="fas fa-sun"></i></span>
                                <span class="toggle-icon moon"><i class="fas fa-moon"></i></span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Farm Information -->
            <div class="settings-section">
                <div class="section-header">
                    <h2><i class="fas fa-farm"></i> Farm Information</h2>
                </div>
                
                <div class="form-group">
                    <label for="farmName">Farm Name</label>
                    <input type="text" id="farmName" placeholder="Enter your farm name">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="managerName">Manager's Name</label>
                        <input type="text" id="managerName" placeholder="Manager name">
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number</label>
                        <input type="tel" id="phoneNumber" placeholder="0712 345 678">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="location">Farm Location</label>
                    <input type="text" id="location" placeholder="City, Country">
                </div>
                
                <div class="form-group">
                    <label for="currency">Currency</label>
                    <select id="currency">
                        <option value="KES">Kenyan Shilling (KES)</option>
                        <option value="USD">US Dollar (USD)</option>
                        <option value="EUR">Euro (EUR)</option>
                        <option value="GBP">British Pound (GBP)</option>
                    </select>
                </div>
            </div>

            <!-- Data Management -->
            <div class="settings-section">
                <div class="section-header">
                    <h2><i class="fas fa-database"></i> Data Management</h2>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Auto Backup</h3>
                        <p>Automatically backup data daily</p>
                    </div>
                    <div class="setting-control">
                        <label class="switch">
                            <input type="checkbox" id="autoBackup">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="data-actions">
                    <button class="btn-action" onclick="exportData()">
                        <i class="fas fa-file-export"></i>
                        <span>Export All Data</span>
                    </button>
                    <button class="btn-action" onclick="importData()">
                        <i class="fas fa-file-import"></i>
                        <span>Import Data</span>
                    </button>
                    <button class="btn-action danger" onclick="resetData()">
                        <i class="fas fa-trash-alt"></i>
                        <span>Reset All Data</span>
                    </button>
                </div>
            </div>

            <!-- Notifications -->
            <div class="settings-section">
                <div class="section-header">
                    <h2><i class="fas fa-bell"></i> Notifications</h2>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Daily Reminders</h3>
                        <p>Remind to record production</p>
                    </div>
                    <div class="setting-control">
                        <label class="switch">
                            <input type="checkbox" id="dailyReminders" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Health Alerts</h3>
                        <p>Alert for animal health issues</p>
                    </div>
                    <div class="setting-control">
                        <label class="switch">
                            <input type="checkbox" id="healthAlerts" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Low Stock Alerts</h3>
                        <p>Alert when feed is low</p>
                    </div>
                    <div class="setting-control">
                        <label class="switch">
                            <input type="checkbox" id="stockAlerts" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- About -->
            <div class="settings-section">
                <div class="section-header">
                    <h2><i class="fas fa-info-circle"></i> About AgriFlow</h2>
                </div>
                
                <div class="about-card">
                    <div class="app-icon">
                        <i class="fas fa-tractor"></i>
                    </div>
                    <div class="app-info">
                        <h3>AgriFlow</h3>
                        <p>Smart Farm Management System</p>
                        <p class="version">Version 2.1.0</p>
                    </div>
                </div>
                
                <div class="about-details">
                    <div class="about-item">
                        <i class="fas fa-calendar"></i>
                        <span>Last Updated: December 2025</span>
                    </div>
                    <div class="about-item">
                        <i class="fas fa-code"></i>
                        <span>Developer: AgriFlow Team</span>
                    </div>
                    <div class="about-item">
                        <i class="fas fa-envelope"></i>
                        <span>support@agriflow.com</span>
                    </div>
                    <div class="about-item">
                        <i class="fas fa-phone"></i>
                        <span>+254 712 345 678</span>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="save-section">
                <button class="btn-primary large" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save All Settings
                </button>
                <button class="btn-secondary" onclick="window.history.back()">
                    Cancel
                </button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-btn">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="dairy.html" class="nav-btn">
                <i class="fas fa-cow"></i>
                <span>Dairy</span>
            </a>
            <a href="poultry.html" class="nav-btn">
                <i class="fas fa-egg"></i>
                <span>Poultry</span>
            </a>
            <a href="master-report.html" class="nav-btn">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>
            <a href="settings.html" class="nav-btn active">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            updateNavActiveState();
            
            // Theme toggle functionality
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('change', function() {
                    toggleTheme(this.checked);
                });
            }
        });
        
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('agriflowSettings')) || {};
            
            // Load values
            document.getElementById('farmName').value = settings.farmName || 'My Farm';
            document.getElementById('managerName').value = settings.managerName || 'Farm Manager';
            document.getElementById('phoneNumber').value = settings.phoneNumber || '';
            document.getElementById('location').value = settings.location || 'Nairobi, Kenya';
            document.getElementById('currency').value = settings.currency || 'KES';
            document.getElementById('themeToggle').checked = settings.darkMode || false;
            document.getElementById('autoBackup').checked = settings.autoBackup || false;
            document.getElementById('dailyReminders').checked = settings.dailyReminders !== false;
            document.getElementById('healthAlerts').checked = settings.healthAlerts !== false;
            document.getElementById('stockAlerts').checked = settings.stockAlerts !== false;
        }
        
        function saveSettings() {
            const settings = {
                farmName: document.getElementById('farmName').value,
                managerName: document.getElementById('managerName').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                location: document.getElementById('location').value,
                currency: document.getElementById('currency').value,
                darkMode: document.getElementById('themeToggle').checked,
                autoBackup: document.getElementById('autoBackup').checked,
                dailyReminders: document.getElementById('dailyReminders').checked,
                healthAlerts: document.getElementById('healthAlerts').checked,
                stockAlerts: document.getElementById('stockAlerts').checked,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('agriflowSettings', JSON.stringify(settings));
            
            // Apply theme immediately
            toggleTheme(settings.darkMode);
            
            showNotification('Settings saved successfully!');
        }
        
        function toggleTheme(isDark) {
            if (isDark) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }
        
        function exportData() {
            const data = {
                farmData: JSON.parse(localStorage.getItem('agriflowData')) || {},
                settings: JSON.parse(localStorage.getItem('agriflowSettings')) || {}
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `agriflow-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.farmData) {
                            localStorage.setItem('agriflowData', JSON.stringify(data.farmData));
                        }
                        
                        if (data.settings) {
                            localStorage.setItem('agriflowSettings', JSON.stringify(data.settings));
                            loadSettings(); // Reload settings
                        }
                        
                        showNotification('Data imported successfully!');
                        
                        // Refresh if on a data page
                        if (!window.location.pathname.includes('settings.html')) {
                            window.location.reload();
                        }
                    } catch (error) {
                        showNotification('Invalid backup file', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function resetData() {
            if (confirm('Are you sure? This will delete ALL farm data and cannot be undone.')) {
                localStorage.removeItem('agriflowData');
                localStorage.removeItem('agriflowSettings');
                
                // Reset to defaults
                const defaultSettings = {
                    farmName: 'My Farm',
                    managerName: 'Farm Manager',
                    location: 'Nairobi, Kenya',
                    darkMode: false,
                    currency: 'KES',
                    autoBackup: false,
                    dailyReminders: true,
                    healthAlerts: true,
                    stockAlerts: true
                };
                
                localStorage.setItem('agriflowSettings', JSON.stringify(defaultSettings));
                localStorage.setItem('agriflowData', JSON.stringify({
                    dairy: { milkProduction: [], animals: [], expenses: [] },
                    poultry: { eggProduction: [], birds: [], expenses: [] }
                }));
                
                loadSettings();
                showNotification('All data has been reset to defaults');
            }
        }
        
        function showNotification(message, type = 'success') {
            // Create notification element
            let notification = document.getElementById('settingsNotification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'settingsNotification';
                notification.className = 'notification';
                document.body.appendChild(notification);
            }
            
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function updateNavActiveState() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('href') === 'settings.html') {
                    btn.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>
