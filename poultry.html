<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poultry Farm - AgriFlow</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="main-header">
            <div class="logo-container">
                <button class="back-btn" onclick="navigateTo('index.html')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h1>Poultry Farm</h1>
                    <p class="tagline" id="farmName">My Farm</p>
                </div>
            </div>
            <button class="menu-btn" onclick="navigateTo('settings.html')">
                <i class="fas fa-cog"></i>
            </button>
        </header>

        <!-- Quick Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-egg"></i>
                </div>
                <div class="stat-content">
                    <h3>Eggs Today</h3>
                    <div class="stat-value" id="eggsToday">0</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-content">
                    <h3>Monthly Profit</h3>
                    <div class="stat-value" id="monthlyProfit">KES 0</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-dove"></i>
                </div>
                <div class="stat-content">
                    <h3>Total Birds</h3>
                    <div class="stat-value" id="totalBirds">0</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-content">
                    <h3>Laying Rate</h3>
                    <div class="stat-value" id="layingRate">0%</div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-bar">
            <button class="action-btn primary" onclick="addEggProduction()">
                <i class="fas fa-plus-circle"></i>
                <span>Add Eggs</span>
            </button>
            <button class="action-btn secondary" onclick="addBirds()">
                <i class="fas fa-plus-circle"></i>
                <span>Add Birds</span>
            </button>
            <button class="action-btn secondary" onclick="recordVaccination()">
                <i class="fas fa-syringe"></i>
                <span>Vaccination</span>
            </button>
        </div>

        <!-- Charts Section -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> Egg Production</h2>
                <select class="period-select" onchange="updatePoultryChart()">
                    <option value="7">7 Days</option>
                    <option value="30" selected>30 Days</option>
                    <option value="90">90 Days</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="eggChart"></canvas>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-history"></i> Recent Activity</h2>
                <button class="btn-small" onclick="showAllActivities()">
                    View All
                </button>
            </div>
            <div class="activity-list" id="activityList">
                <div class="empty-state">
                    <i class="fas fa-info-circle"></i>
                    <p>No activities recorded yet</p>
                    <button class="btn-action" onclick="addEggProduction()">Add First Record</button>
                </div>
            </div>
        </div>

        <!-- Flock Summary -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Flock Summary</h2>
            </div>
            <div class="flock-grid">
                <div class="flock-card">
                    <div class="flock-count" id="layers">0</div>
                    <div class="flock-label">Layers</div>
                </div>
                <div class="flock-card">
                    <div class="flock-count" id="broilers">0</div>
                    <div class="flock-label">Broilers</div>
                </div>
                <div class="flock-card">
                    <div class="flock-count" id="chicks">0</div>
                    <div class="flock-label">Chicks</div>
                </div>
                <div class="flock-card">
                    <div class="flock-count" id="mortality">0%</div>
                    <div class="flock-label">Mortality</div>
                </div>
            </div>
        </div>

        <!-- Feed Management -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-seedling"></i> Feed Management</h2>
                <button class="btn-small" onclick="calculateFeed()">
                    <i class="fas fa-calculator"></i>
                </button>
            </div>
            <div class="feed-summary">
                <div class="feed-item">
                    <div class="feed-label">Daily Feed</div>
                    <div class="feed-value" id="dailyFeed">0 kg</div>
                </div>
                <div class="feed-item">
                    <div class="feed-label">Feed Cost/Day</div>
                    <div class="feed-value" id="feedCost">KES 0</div>
                </div>
                <div class="feed-item">
                    <div class="feed-label">Stock Remaining</div>
                    <div class="feed-value" id="feedStock">0 days</div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-btn">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="dairy.html" class="nav-btn">
                <i class="fas fa-cow"></i>
                <span>Dairy</span>
            </a>
            <a href="poultry.html" class="nav-btn active">
                <i class="fas fa-egg"></i>
                <span>Poultry</span>
            </a>
            <a href="master-report.html" class="nav-btn">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>
            <a href="settings.html" class="nav-btn">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>

    <!-- Modals -->
    <div id="addEggsModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-egg"></i> Record Egg Collection</h3>
            <div class="form-group">
                <label for="eggCount">Number of Eggs</label>
                <input type="number" id="eggCount" min="0" placeholder="Enter count">
            </div>
            <div class="form-group">
                <label for="brokenEggs">Broken Eggs</label>
                <input type="number" id="brokenEggs" min="0" value="0" placeholder="Optional">
            </div>
            <div class="form-actions">
                <button class="btn-secondary" onclick="closeModal('addEggsModal')">Cancel</button>
                <button class="btn-primary" onclick="saveEggProduction()">Save</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/charts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadPoultryData();
            updatePoultryChart();
            updateNavActiveState();
        });
        
        function loadPoultryData() {
            const data = JSON.parse(localStorage.getItem('agriflowData')) || {};
            const poultry = data.poultry || { eggProduction: [], birds: [] };
            updatePoultryUI(poultry);
        }
        
        function updatePoultryUI(poultry) {
            const today = new Date().toISOString().split('T')[0];
            const todayEggs = poultry.eggProduction
                .filter(p => p.date === today)
                .reduce((sum, p) => sum + (p.count || 0), 0);
            
            const totalEggs = poultry.eggProduction.reduce((sum, p) => sum + (p.count || 0), 0);
            
            document.getElementById('eggsToday').textContent = todayEggs;
            document.getElementById('totalBirds').textContent = poultry.birds.length;
            
            updatePoultryActivityList(poultry.eggProduction.slice(-3).reverse());
        }
        
        function updatePoultryActivityList(activities) {
            const container = document.getElementById('activityList');
            if (!activities || activities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-info-circle"></i>
                        <p>No activities recorded yet</p>
                        <button class="btn-action" onclick="addEggProduction()">Add First Record</button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            activities.forEach(activity => {
                const date = new Date(activity.date).toLocaleDateString();
                html += `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-egg"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-title">Egg Collection</div>
                            <div class="activity-subtitle">${date}</div>
                        </div>
                        <div class="activity-value">${activity.count} eggs</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
        
        function addEggProduction() {
            document.getElementById('addEggsModal').style.display = 'flex';
        }
        
        function saveEggProduction() {
            const count = parseInt(document.getElementById('eggCount').value);
            const broken = parseInt(document.getElementById('brokenEggs').value) || 0;
            
            if (!count || count <= 0) {
                alert('Please enter a valid egg count');
                return;
            }
            
            const record = {
                date: new Date().toISOString().split('T')[0],
                count: count,
                broken: broken
            };
            
            if (window.app) {
                window.app.addProduction('poultry', record);
            }
            
            closeModal('addEggsModal');
            document.getElementById('eggCount').value = '';
            document.getElementById('brokenEggs').value = '0';
            loadPoultryData();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function updateNavActiveState() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('href') === 'poultry.html') {
                    btn.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>